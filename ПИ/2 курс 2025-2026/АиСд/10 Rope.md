## Rope - это
➢Rope - структура данных для хранения строки, представляющая из себя двоичное сбалансированное дерево и позволяющая делать операции вставки, удаления и конкатенации с логарифмической асимптотикой.

## Особенности

➢Балансировка происходит также как в АВЛ-дереве
➢В каждом листе хранится последовательная часть строки и ее длина, а в промежуточных вершинах хранится сумма длин всех листьев в поддереве.
➢Изначально дерево состоит из одной вершины — самой строки.
➢Используя информацию в промежуточных вершинах, можно получать символы строки по индексу.
➢Все внутренние вершины имеют ровно двух детей, а листы — ни одного.

## Свойства Rope

➢Операции, которые часто используются на строках, должны быть более эффективными. Например: конкатенация, взятие подстроки.
➢Также эти операции должны эффективно работать и с длинными строками. Не должно быть прямой зависимости от длины строк.

➢Персистентность(хранение предыдущих состояний). Иногда необходимо при изменении строки сохранить ее состояние перед изменением и вернуться к нему, если необходимо.

### Поиск символа по индексу
Для поиска символа с индексом i спускаемся по дереву из корня, используя веса, записанные в вершинах для определения направления спуска:
➢Текущая вершина не лист:
	○ w ≥ i, тогда идем в левое поддерево.
	○ Иначе идем в правое поддерево и ищем там i - w символ.
➢Текущая вершина лист
	○ Возвращаем символ с соответствующим номером.

### Конкатенация
Для конкатенации с другой строкой:
➢Создаем новый корень
➢Подвешиваем к нему обе строки
![[Pasted image 20260113100412.png]]

### Разбиение строки 
Для разбиения строки на две по индексу i:
➢Спускаемся по дереву аналогично поиску:
	○ Делим каждую вершину на две, каждая из которых будет соответствовать разным половинам строки.
➢Пересчитываем вес каждой вершины.
➢Избавляемся от вершин, у которых только один потомок.
Рассмотрим разбиение строки по индексу 16.
![[Pasted image 20260113100636.png]]
![[Pasted image 20260113100655.png]]![[Pasted image 20260113100726.png]]

### Вставка и удаление подстроки
➢Операции вставки и удаления подстроки происходит посредством использования методов разбиения и слияния строк.
➢Операция удаления - удаляет из строки подстроку, начиная с индекса beginIndex и заканчивая (не включая) индексом endIndex
➢Операция вставки - вставляет данную строку в исходную, начиная с позиции insertIndex.

*Вставка*
➢Разбиваем дерево на 2 по индексу insertIndex.
➢Сливаем левое получившиеся дерево с нодой, которая хранит подстроку
➢Сливаем результат предыдущей операции с правым деревом, получившимся после разбиения.

*Удаление*
➢Разбиваем дерево на 2 по индексу beginIndex.
➢Разбиваем правое дерево, получившиеся в результате предыдущей операции по индексу endIndex - beginIndex.
➢Берем левое поддерево, получившиеся в результате первого разбиения, и сливаем его с правым деревом, получившимся в результате второго разбиения.