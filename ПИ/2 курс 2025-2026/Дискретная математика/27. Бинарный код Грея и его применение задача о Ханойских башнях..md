### **Конспект по теме: Бинарный код Грея и его применение: задача о Ханойских башнях**

**Источник:** Общепринятые определения и алгоритмы, соответствующие разделам 1.6.9 и 1.6.9.1 учебника С.В. Рыбина.

---

#### **1. Бинарный код Грея (циклический код)**

**Определение:** Бинарный код Грея длины \(n\) — это последовательность всех \(2^n\) двоичных векторов длины \(n\), в которой каждые два соседних вектора (включая последний и первый) отличаются ровно в **одном бите**.

*   **Пример для \(n=3\):**  
    ```
    000 → 001 → 011 → 010 → 110 → 111 → 101 → 100
    ```
    (замыкание в цикл: 100 → 000 также отличается в одном бите).

*   **Свойство:** Код Грея минимизирует количество изменений битов при последовательном переборе всех двоичных комбинаций, что важно в дискретных устройствах для предотвращения ложных срабатываний.

---

#### **2. Построение кода Грея**

**2.1. Рекурсивный метод построения (отражённый код Грея)**
*   **Базис:** Для \(n=1\) код Грея: \(G_1 = [0, 1]\).
*   **Шаг рекурсии:** Пусть \(G_n\) — код Грея длины \(n\). Тогда код Грея длины \(n+1\) строится так:
    1.  Возьмём \(G_n\) и припишем в начале каждого слова дополнительный бит 0. Получим список \(L_1\).
    2.  Возьмём \(G_n\) в **обратном порядке** и припишем в начале каждого слова бит 1. Получим список \(L_2\).
    3.  Новый код: \(G_{n+1} = L_1\) конкатенация \(L_2\).

*   **Пример построения \(G_3\) из \(G_2\):**
    *   \(G_2 = [00, 01, 11, 10]\).
    *   \(L_1 = [000, 001, 011, 010]\).
    *   Обратный \(G_2 = [10, 11, 01, 00]\), с добавлением 1: \(L_2 = [110, 111, 101, 100]\).
    *   \(G_3 = [000, 001, 011, 010, 110, 111, 101, 100]\).

**2.2. Аналитическое преобразование: двоичный код → код Грея**
Пусть \(b_{n-1}b_{n-2}...b_1b_0\) — двоичное представление числа (старший бит слева). Тогда соответствующий код Грея \(g_{n-1}g_{n-2}...g_1g_0\) вычисляется по правилу:
\[
g_{n-1} = b_{n-1}, \quad g_i = b_i \oplus b_{i+1} \ \text{для} \ i = 0, 1, ..., n-2,
\]
где \(\oplus\) — сложение по модулю 2 (XOR).  
*   **Пример:** Число 6 в двоичном виде: \(110_2\). Код Грея:  
    \(g_2 = b_2 = 1\),  
    \(g_1 = b_1 \oplus b_2 = 1 \oplus 1 = 0\),  
    \(g_0 = b_0 \oplus b_1 = 0 \oplus 1 = 1\).  
    Результат: \(101_{\text{Грея}}\).

**2.3. Обратное преобразование: код Грея → двоичный код**
\[
b_{n-1} = g_{n-1}, \quad b_i = g_i \oplus b_{i+1} \ \text{для} \ i = n-2, ..., 0.
\]
*   **Пример:** Код Грея \(101\):  
    \(b_2 = g_2 = 1\),  
    \(b_1 = g_1 \oplus b_2 = 0 \oplus 1 = 1\),  
    \(b_0 = g_0 \oplus b_1 = 1 \oplus 1 = 0\).  
    Двоичное число: \(110_2 = 6\).

---

#### **3. Задача о Ханойских башнях**

**Постановка:** Даны три стержня (A, B, C) и \(n\) дисков разного размера, нанизанных на стержень A в порядке убывания размеров (самый большой внизу). Цель — перенести всю пирамиду на стержень C, используя стержень B как вспомогательный, соблюдая правила:
1.  За один ход можно переносить только **один диск**.
2.  Нельзя класть больший диск на меньший.

**Классическое рекурсивное решение:**
1.  Перенести \(n-1\) верхних дисков с A на B (используя C как вспомогательный).
2.  Перенести самый большой диск с A на C.
3.  Перенести \(n-1\) дисков с B на C (используя A как вспомогательный).

Число ходов: \(T(n) = 2T(n-1) + 1\), откуда \(T(n) = 2^n - 1\).

---

#### **4. Связь с кодом Грея**

**4.1. Кодирование состояний:**
Состояние пирамиды можно закодировать **вектором длины \(n\)**, где \(i\)-й компонент (соответствующий \(i\)-му по размеру диску, считая от самого маленького) указывает номер стержня (0, 1 или 2), на котором находится этот диск. Начальное состояние: все диски на стержне 0.

**4.2. Последовательность ходов как код Грея:**
*   Диски пронумерованы от 1 (самый маленький) до \(n\) (самый большой).
*   На каждом шаге перемещается **ровно один диск**.
*   **Ключевое наблюдение:** В оптимальном решении на каждом шаге перемещается **самый маленький из подвижных дисков**, причём он всегда перемещается в одном и том же направлении (например, для нечётного числа дисков — по циклу A→B→C→A, для чётного — A→C→B→A).
*   Если сопоставить каждому диску **двоичный код Грея**, то последовательность состояний диска \(i\) будет соответствовать изменению \(i\)-го бита в последовательности кодов Грея длины \(n\).

**4.3. Алгоритм решения через код Грея:**
1.  Сгенерировать все \(2^n\) кодов Грея \(g_0, g_1, ..., g_{2^n-1}\).
2.  Для каждого перехода от \(g_k\) к \(g_{k+1}\) определить, какой бит изменился — это номер перемещаемого диска (биты нумеруются от 0, диск 0 — самый маленький).
3.  Направление перемещения определяется чётностью суммы битов слева от изменяемого (для стандартного направления).

*   **Пример для \(n=3\) (коды Грея из примера выше):**
    *   Переход 000 → 001: изменился бит 0 (самый маленький диск) → перемещаем диск 1.
    *   Переход 001 → 011: изменился бит 1 → перемещаем диск 2.
    *   Переход 011 → 010: изменился бит 0 → перемещаем диск 1.
    *   Переход 010 → 110: изменился бит 2 → перемещаем диск 3.
    *   Переход 110 → 111: изменился бит 0 → перемещаем диск 1.
    *   Переход 111 → 101: изменился бит 1 → перемещаем диск 2.
    *   Переход 101 → 100: изменился бит 0 → перемещаем диск 1.

**4.4. Доказательство корректности:**
*   Индукция по \(n\).
*   Базис: для \(n=1\) код Грея: 0 → 1, что соответствует перемещению единственного диска.
*   Переход: рассмотрим решение для \(n\) дисков. Первые \(2^{n-1}-1\) ходов перемещают \(n-1\) верхних дисков на вспомогательный стержень. Это соответствует прохождению по коду Грея для \(n-1\) дисков (биты 1..n-1). Затем ход \(2^{n-1}\) — перемещение самого большого диска (бит \(n\)). Последующие \(2^{n-1}-1\) ходов — перемещение \(n-1\) дисков на конечный стержень, что соответствует прохождению по коду Грея для \(n-1\) дисков в обратном порядке. Таким образом, полная последовательность соответствует отражённому построению кода Грея длины \(n\).

---

#### **5. Другие свойства и применения кода Грея**

*   **Цикличность:** Код Грея образует **цикл**, что соответствует возможности повторного решения задачи (после переноса всей пирамиды можно начать заново).
*   **Эффективность:** Алгоритм на основе кода Грея позволяет генерировать ходы за константное время на ход.
*   **Обобщения:**
    *   **Задача с четырьмя и более стержнями** (Рекусивная задача "Ханойские башни" или "Фрейда-Шухгальтера") также имеет связи с обобщёнными кодами Грея.
    *   **Задача о китайских кольцах** (Baguenaudier) — классическая головоломка, чьё решение в точности описывается двоичным кодом Грея.

**Заключение:** Бинарный код Грея — не только важный объект теории кодирования, но и мощный инструмент для анализа и решения комбинаторных задач. Задача о Ханойских башнях демонстрирует, как естественная последовательность операций в рекурсивном алгоритме соответствует упорядочению двоичных векторов в коде Грея. Это позволяет не только прояснить структуру решения, но и построить эффективные нерекурсивные алгоритмы.