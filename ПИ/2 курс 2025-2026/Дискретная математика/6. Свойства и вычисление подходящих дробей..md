# **6. СВОЙСТВА И ВЫЧИСЛЕНИЕ ПОДХОДЯЩИХ ДРОБЕЙ**

## **1. ОПРЕДЕЛЕНИЯ И ОБОЗНАЧЕНИЯ**

### **Определение 1.8 (Подходящие дроби)**
Пусть дана цепная дробь:
$$
\alpha = q_0 + \cfrac{1}{q_1 + \cfrac{1}{q_2 + \cfrac{1}{\ddots + \cfrac{1}{q_n}}}} = [q_0; q_1, q_2, \dots, q_n]
$$

**Подходящими дробями** называются дроби, получаемые при обрывании цепной дроби на различных звеньях:
$$
\begin{aligned}
\delta_0 &= q_0 = \frac{P_0}{Q_0} \\
\delta_1 &= q_0 + \frac{1}{q_1} = \frac{P_1}{Q_1} \\
\delta_2 &= q_0 + \cfrac{1}{q_1 + \cfrac{1}{q_2}} = \frac{P_2}{Q_2} \\
&\vdots \\
\delta_n &= \alpha = \frac{P_n}{Q_n}
\end{aligned}
$$
где $P_s, Q_s$ — числитель и знаменатель $s$-й подходящей дроби.

---

## **2. РЕКУРРЕНТНЫЕ ФОРМУЛЫ**

### **Теорема (Формулы вычисления числителей и знаменателей)**
Для любого $s \geq 1$ справедливы рекуррентные соотношения:
$$
\boxed{
\begin{aligned}
P_s &= q_s \cdot P_{s-1} + P_{s-2} \\
Q_s &= q_s \cdot Q_{s-1} + Q_{s-2}
\end{aligned}}
$$
с начальными условиями:
$$
P_{-1} = 1, \quad Q_{-1} = 0, \quad P_0 = q_0, \quad Q_0 = 1
$$

---

### **Доказательство (по индукции):**
**База индукции:**
- При $s = 0$: $\delta_0 = q_0 = \frac{P_0}{Q_0}$ — выполнено.
- При $s = 1$:
  $$
  \delta_1 = q_0 + \frac{1}{q_1} = \frac{q_0 q_1 + 1}{q_1}
  $$
  С другой стороны:
  $$
  P_1 = q_1 P_0 + P_{-1} = q_1 q_0 + 1, \quad Q_1 = q_1 Q_0 + Q_{-1} = q_1 \cdot 1 + 0 = q_1
  $$

**Шаг индукции:** Предположим, формула верна для $s-1$ и $s$. Докажем для $s+1$.

Представим подходящую дробь $\delta_{s+1}$ через $\delta_s$:
$$
\delta_{s+1} = [q_0; q_1, \dots, q_s, q_{s+1}]
$$
Заметим, что если в дроби $\delta_s = [q_0; q_1, \dots, q_s]$ заменить последнее звено $q_s$ на $q_s + \frac{1}{q_{s+1}}$, получим $\delta_{s+1}$.

Пусть $\delta_s' = [q_0; q_1, \dots, q_{s-1}, q_s + \frac{1}{q_{s+1}}]$. Тогда:
$$
\delta_{s+1} = \frac{(q_s + \frac{1}{q_{s+1}})P_{s-1} + P_{s-2}}{(q_s + \frac{1}{q_{s+1}})Q_{s-1} + Q_{s-2}}
= \frac{q_s P_{s-1} + P_{s-2} + \frac{P_{s-1}}{q_{s+1}}}{q_s Q_{s-1} + Q_{s-2} + \frac{Q_{s-1}}{q_{s+1}}}
$$
$$
= \frac{P_s + \frac{P_{s-1}}{q_{s+1}}}{Q_s + \frac{Q_{s-1}}{q_{s+1}}}
= \frac{q_{s+1} P_s + P_{s-1}}{q_{s+1} Q_s + Q_{s-1}}
$$
Таким образом:
$$
P_{s+1} = q_{s+1} P_s + P_{s-1}, \quad Q_{s+1} = q_{s+1} Q_s + Q_{s-1}
$$

---

## **3. ОСНОВНЫЕ СВОЙСТВА ПОДХОДЯЩИХ ДРОБЕЙ**

### **Лемма 1.4 (Свойство разности соседних дробей)**
Для любого $s \geq 1$ выполняется:
$$
\boxed{
\frac{P_s}{Q_s} - \frac{P_{s-1}}{Q_{s-1}} = \frac{(-1)^{s+1}}{Q_s Q_{s-1}}
}
$$

**Доказательство:**
Рассмотрим определитель:
$$
\Delta_s = P_s Q_{s-1} - P_{s-1} Q_s
$$
Используя рекуррентные формулы:
$$
\begin{aligned}
\Delta_s &= (q_s P_{s-1} + P_{s-2}) Q_{s-1} - P_{s-1}(q_s Q_{s-1} + Q_{s-2}) \\
&= q_s P_{s-1} Q_{s-1} + P_{s-2} Q_{s-1} - q_s P_{s-1} Q_{s-1} - P_{s-1} Q_{s-2} \\
&= P_{s-2} Q_{s-1} - P_{s-1} Q_{s-2} \\
&= -\Delta_{s-1}
\end{aligned}
$$
Так как $\Delta_0 = P_0 Q_{-1} - P_{-1} Q_0 = q_0 \cdot 0 - 1 \cdot 1 = -1$, то:
$$
\Delta_s = (-1)^{s+1}
$$
Отсюда:
$$
\frac{P_s}{Q_s} - \frac{P_{s-1}}{Q_{s-1}} = \frac{P_s Q_{s-1} - P_{s-1} Q_s}{Q_s Q_{s-1}} = \frac{(-1)^{s+1}}{Q_s Q_{s-1}}
$$

---

### **Следствие 1.3 (Несократимость подходящих дробей)**
Все подходящие дроби $\frac{P_s}{Q_s}$ являются несократимыми.

**Доказательство:**  
Из леммы 1.4: $P_s Q_{s-1} - P_{s-1} Q_s = (-1)^{s+1}$.  
Любой общий делитель $P_s$ и $Q_s$ должен делить $(-1)^{s+1}$, следовательно, равен 1.

---

### **Следствие 1.4 (Монотонность знаменателей)**
Последовательность знаменателей $\{Q_s\}$ строго возрастает при $s \geq 1$:
$$
Q_0 = 1 \leq Q_1 < Q_2 < Q_3 < \cdots
$$

**Доказательство:**  
Из рекуррентной формулы $Q_s = q_s Q_{s-1} + Q_{s-2}$ и того, что $q_s \geq 1$ (для $s \geq 1$), следует:
$$
Q_s \geq Q_{s-1} + Q_{s-2} > Q_{s-1} \quad \text{при } s \geq 2
$$
Для $s = 1$: $Q_1 = q_1 \geq 1 = Q_0$, причём равенство возможно только при $q_1 = 1$.

---

### **Теорема 1.18 (Чередование подходящих дробей)**
Подходящие дроби с чётными номерами образуют возрастающую последовательность, с нечётными — убывающую:
$$
\delta_0 < \delta_2 < \delta_4 < \cdots < \alpha < \cdots < \delta_5 < \delta_3 < \delta_1
$$
при этом каждая следующая подходящая дробь ближе к $\alpha$, чем предыдущая.

**Доказательство:**  
Из леммы 1.4:
- При чётном $s$: $\delta_s - \delta_{s-1} = \frac{1}{Q_s Q_{s-1}} > 0 \Rightarrow \delta_s > \delta_{s-1}$
- При нечётном $s$: $\delta_s - \delta_{s-1} = -\frac{1}{Q_s Q_{s-1}} < 0 \Rightarrow \delta_s < \delta_{s-1}$

Так как $\alpha$ всегда лежит между $\delta_s$ и $\delta_{s+1}$, то:
$$
|\alpha - \delta_s| < |\delta_{s+1} - \delta_s| = \frac{1}{Q_{s+1} Q_s}
$$

---

## **4. ТАБЛИЧНЫЙ МЕТОД ВЫЧИСЛЕНИЯ**

### **Алгоритм построения таблицы подходящих дробей**

1. **Заголовки столбцов:**
   - $s$ — номер подходящей дроби
   - $q_s$ — звено цепной дроби
   - $P_s$ — числитель
   - $Q_s$ — знаменатель

2. **Начальные условия:**
   $$
   \begin{array}{c|cccc}
   s & q_s & P_s & Q_s & \delta_s = P_s/Q_s \\
   \hline
   -1 & — & 1 & 0 & — \\
   0 & q_0 & q_0 & 1 & q_0 \\
   \end{array}
   $$

3. **Рекуррентное заполнение:** Для $s = 1, 2, \dots, n$:
   $$
   P_s = q_s \cdot P_{s-1} + P_{s-2}, \quad Q_s = q_s \cdot Q_{s-1} + Q_{s-2}
   $$

---

### **Пример 1.17:** Вычисление подходящих дробей для $\frac{4704}{2808} = [1; 1, 2, 12, 1, 2]$

**Таблица 1.15:**
$$
\begin{array}{c|cccc}
s & q_s & P_s & Q_s & \delta_s \\
\hline
-1 & — & 1 & 0 & — \\
0 & 1 & 1 & 1 & 1 \\
1 & 1 & 2 & 1 & 2 \\
2 & 2 & 5 & 3 & \frac{5}{3} \approx 1.6667 \\
3 & 12 & 62 & 37 & \frac{62}{37} \approx 1.6757 \\
4 & 1 & 67 & 40 & \frac{67}{40} = 1.675 \\
5 & 2 & 196 & 117 & \frac{196}{117} = \frac{4704}{2808} \approx 1.6752
\end{array}
$$

**Проверка свойства разности:**
$$
\delta_1 - \delta_0 = 2 - 1 = 1 = \frac{(-1)^2}{Q_1 Q_0} = \frac{1}{1 \cdot 1}
$$
$$
\delta_2 - \delta_1 = \frac{5}{3} - 2 = -\frac{1}{3} = \frac{(-1)^3}{Q_2 Q_1} = -\frac{1}{3 \cdot 1}
$$
$$
\delta_3 - \delta_2 = \frac{62}{37} - \frac{5}{3} = \frac{1}{111} = \frac{(-1)^4}{Q_3 Q_2} = \frac{1}{37 \cdot 3}
$$

---

## **5. ОЦЕНКИ ПРИБЛИЖЕНИЯ**

### **Следствие 1.6 (Точность приближения)**
Для любого вещественного $\alpha$ и его подходящей дроби $\delta_s = \frac{P_s}{Q_s}$ выполняется:
$$
\boxed{
\left|\alpha - \frac{P_s}{Q_s}\right| \leq \frac{1}{Q_s Q_{s+1}} < \frac{1}{Q_s^2}
}
$$

**Доказательство:**  
Так как $\alpha$ лежит между $\delta_s$ и $\delta_{s+1}$, то:
$$
\left|\alpha - \delta_s\right| \leq \left|\delta_{s+1} - \delta_s\right| = \frac{1}{Q_{s+1} Q_s}
$$
Поскольку последовательность $\{Q_s\}$ возрастает, $Q_{s+1} > Q_s$, следовательно:
$$
\frac{1}{Q_{s+1} Q_s} < \frac{1}{Q_s^2}
$$

---

### **Пример оценки точности**
Для $\frac{4704}{2808}$:

- При $s = 2$: $\delta_2 = \frac{5}{3} \approx 1.6667$, $Q_2 = 3$, оценка:
  $$
  \left|\alpha - \frac{5}{3}\right| < \frac{1}{3^2} = \frac{1}{9} \approx 0.1111
  $$
  Фактическая ошибка: $\left|1.6752 - 1.6667\right| = 0.0085$

- При $s = 3$: $\delta_3 = \frac{62}{37} \approx 1.6757$, $Q_3 = 37$, оценка:
  $$
  \left|\alpha - \frac{62}{37}\right| < \frac{1}{37^2} = \frac{1}{1369} \approx 0.00073
  $$
  Фактическая ошибка: $\left|1.6752 - 1.6757\right| = 0.0005$

---

## **6. СВОЙСТВО НАИЛУЧШИХ ПРИБЛИЖЕНИЙ**

### **Определение 1.13 (Наилучшее приближение)**
Дробь $\frac{a}{b}$ называется **наилучшим приближением** к числу $\alpha$, если не существует дроби $\frac{x}{y}$ с меньшим знаменателем ($0 < y \leq b$), которая приближает $\alpha$ лучше:
$$
\left|\alpha - \frac{x}{y}\right| < \left|\alpha - \frac{a}{b}\right|
$$

---

### **Теорема 1.20 (Свойство промежутка между подходящими дробями)**
Рассмотрим промежуток $\left(\frac{a}{b}, \frac{c}{d}\right)$, для которого выполняется:
$$
bc - ad = 1, \quad \frac{c}{d} - \frac{a}{b} = \frac{1}{bd}
$$
Тогда знаменатели всех рациональных чисел, лежащих внутри этого промежутка, больше знаменателей его концов.

**Следствие 1.8:** Все подходящие дроби, начиная со второй, являются наилучшими приближениями.

---

## **7. СВЯЗЬ С АЛГОРИТМОМ ЕВКЛИДА И КОНТИНУАНТАМИ**

### **Определение 1.9 (Континуанта)**
Континуантой $n$-го порядка называется определитель:
$$
K_n(q_0, q_1, \dots, q_{n-1}) =
\begin{vmatrix}
q_0 & 1 & 0 & \cdots & 0 \\
-1 & q_1 & 1 & \cdots & 0 \\
0 & -1 & q_2 & \cdots & 0 \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
0 & 0 & 0 & \cdots & q_{n-1}
\end{vmatrix}
$$

---

### **Лемма 1.6 (Эйлер)**
Справедливо тождество:
$$
[q_0; q_1, \dots, q_{n-1}] = \frac{K_n(q_0, q_1, \dots, q_{n-1})}{K_{n-1}(q_1, q_2, \dots, q_{n-1})}
$$
При этом:
$$
P_{n-1} = K_n(q_0, q_1, \dots, q_{n-1}), \quad Q_{n-1} = K_{n-1}(q_1, q_2, \dots, q_{n-1})
$$

---

### **Пример 1.18:**
Для цепной дроби $[q_0, q_1, q_2, q_3, q_4, q_5]$:
$$
K_6 = q_0 q_1 q_2 q_3 q_4 q_5 + q_2 q_3 q_4 q_5 + q_0 q_3 q_4 q_5 + q_0 q_1 q_4 q_5 + q_0 q_1 q_2 q_5 + q_0 q_1 q_2 q_3 + q_4 q_5 + q_2 q_5 + q_0 q_5 + q_2 q_3 + q_0 q_3 + q_0 q_1 + 1
$$

---

## **8. ПРАКТИЧЕСКИЕ ВЫВОДЫ**

### **Алгоритм вычисления подходящих дробей:**
1. Разложить число в цепную дробь (алгоритм Евклида).
2. Использовать рекуррентные формулы:
   $$
   \begin{aligned}
   P_s &= q_s P_{s-1} + P_{s-2} \\
   Q_s &= q_s Q_{s-1} + Q_{s-2}
   \end{aligned}
   $$
   с начальными условиями $P_{-1}=1, Q_{-1}=0, P_0=q_0, Q_0=1$.

3. Каждая подходящая дробь даёт приближение с ошибкой $< \frac{1}{Q_s^2}$.

### **Свойства, важные для приложений:**
1. **Быстрое вычисление:** Рекуррентные формулы требуют $O(n)$ арифметических операций.
2. **Наилучшие приближения:** Подходящие дроби дают наилучшие рациональные приближения.
3. **Чередование:** Позволяет находить приближения как сверху, так и снизу.
4. **Быстрая сходимость:** Ошибка убывает как $1/Q_s^2$.
5. **Связь с НОД:** Коэффициенты подходящих дробей связаны с коэффициентами Безу.

---

## **9. ИСТОРИЧЕСКИЕ КОММЕНТАРИИ**

1. **Рафаэль Бомбелли** (1572) — впервые ввёл цепные дроби.
2. **Пьетро Катальди** (1613) — современное обозначение цепных дробей.
3. **Леонард Эйлер** (XVIII в.) — систематическая теория, связь с континуантами.
4. **Жозеф Луи Лагранж** (1768) — применение в теории приближений.

---

## **10. ПРИМЕНЕНИЯ**

1. **Приближение иррациональных чисел:** Нахождение рациональных приближений с минимальным знаменателем.
2. **Решето Эратосфена в зубчатых передачах:** Построение передаточных отношений.
3. **Календарные расчёты:** Приближение длины года (365.2422 дня).
4. **Криптография:** В атаках на RSA с использованием непрерывных дробей.
5. **Теория чисел:** Исследование диофантовых приближений.

**Пример календарного применения:**  
Длина тропического года ≈ 365.2422 суток.  
Разложение в цепную дробь:
$$
365.2422 = [365; 4, 7, 1, 3, 5, 20, \dots]
$$
Подходящие дроби:
- $\delta_0 = 365$ (юлианский год — 365 суток)
- $\delta_1 = 365\frac{1}{4} = 365.25$ (високосный каждый 4-й год)
- $\delta_2 = 365\frac{7}{29} \approx 365.2414$ (29 лет, 7 високосных)
- $\delta_3 = 365\frac{8}{33} \approx 365.2424$ (персидский календарь Омара Хайяма)
- $\delta_4 = 365\frac{31}{128} \approx 365.2422$ (предложение Медлера, 128 лет, 31 високосный)