
Поскольку в предоставленном фрагменте учебника (стр. 1-91) раздел 1.6.13 «Введение в динамическое программирование. Задача о рюкзаке» (стр. 202) не содержится, я составлю строгий математический конспект по стандартным формулировкам этих классических задач, соответствующий стилю и строгости учебника Рыбина.

---

### **Конспект: Динамическое программирование для задач о рюкзаке**

#### **1. Постановка общей задачи**
Имеется **рюкзак** вместимостью `W` (максимальный допустимый вес) и набор из `n` предметов.
Каждый предмет `i` (где `i = 1...n`) характеризуется:
*   `w_i` — вес предмета,
*   `v_i` — стоимость (ценность) предмета.

**Цель:** Выбрать подмножество предметов, суммарный вес которых **не превышает** `W`, а их суммарная стоимость **максимальна**.

В зависимости от условий выбора предметов различают две основные задачи.

#### **2. Задача о неограниченном рюкзаке (Unbounded Knapsack)**
**Условие:** Каждый предмет каждого типа доступен в **неограниченном количестве** (можно брать любое количество каждого предмета).

##### **2.1. Формализация**
Требуется найти такие **неотрицательные целые числа** `x_1, x_2, ..., x_n` (количество взятых предметов каждого типа), чтобы:
1.  `Σ (i=1..n) w_i * x_i ≤ W` (ограничение по весу).
2.  `Σ (i=1..n) v_i * x_i → max` (целевая функция — максимизация стоимости).

##### **2.2. Метод динамического программирования**
**Определение состояния:** Пусть `F(s)` — **максимальная стоимость**, которую можно набрать предметами в рюкзаке вместимостью `s` (где `0 ≤ s ≤ W`).

**Базовый случай:** `F(0) = 0`. Рюкзак нулевой вместимости имеет нулевую стоимость.

**Рекуррентное соотношение (переход):**
Чтобы получить оптимальный набор для рюкзака вместимости `s`, можно рассмотреть последний добавленный предмет. Если мы добавляем предмет типа `i`, то оставшаяся вместимость будет `s - w_i`, и к стоимости добавится `v_i`. Поскольку предметы неограниченны, предмет типа `i` снова доступен для выбора.
`F(s) = max ( i: w_i ≤ s ) { F(s - w_i) + v_i }`
где максимум берётся по всем типам предметов `i`, которые помещаются в оставшийся объём (`w_i ≤ s`). Если ни один предмет не помещается, то `F(s) = 0`.

**Порядок вычислений:** Вычисляем `F(s)` последовательно для `s = 1, 2, ..., W`.

**Восстановление ответа:** Для определения состава набора, давшего стоимость `F(W)`, нужно хранить дополнительный массив, фиксирующий, какой предмет был добавлен на каждом шаге, или пройтись обратно от `s = W`, пока `s > 0`, каждый раз находя предмет `i`, для которого достигнут максимум: `F(s) = F(s - w_i) + v_i`, затем положить `s = s - w_i` и увеличить счётчик для предмета `i`.

##### **2.3. Пример**
Пусть `W = 8`, предметы:
1.  (w=2, v=5)
2.  (w=3, v=6)
3.  (w=6, v=17)

Вычисляем `F(s)`:
*   `F(0) = 0`
*   `F(1) = 0` (ни один предмет не помещается)
*   `F(2) = max{F(0)+5} = 5`
*   `F(3) = max{F(1)+5, F(0)+6} = max{0+5, 0+6} = 6`
*   `F(4) = max{F(2)+5, F(1)+6} = max{5+5, 0+6} = 10` (2 предмета №1)
*   `F(5) = max{F(3)+5, F(2)+6} = max{6+5, 5+6} = 11` (предмет №1 и №2)
*   `F(6) = max{F(4)+5, F(3)+6, F(0)+17} = max{10+5, 6+6, 0+17} = 17` (лучше один предмет №3)
*   `F(7) = max{F(5)+5, F(4)+6, F(1)+17} = max{11+5, 10+6, 0+17} = 17`
*   `F(8) = max{F(6)+5, F(5)+6, F(2)+17} = max{17+5, 11+6, 5+17} = 22` (предмет №3 + предмет №1)

**Ответ:** Максимальная стоимость = 22. Состав: один предмет №3 (w=6, v=17) и один предмет №1 (w=2, v=5).

---

#### **3. Задача о рюкзаке 0-1 (0-1 Knapsack)**
**Условие:** Каждый предмет **можно взять не более одного раза** (либо 0, либо 1 экземпляр каждого).

##### **3.1. Формализация**
Требуется найти такой **набор бинарных переменных** `x_1, x_2, ..., x_n ∈ {0, 1}`, чтобы:
1.  `Σ (i=1..n) w_i * x_i ≤ W`.
2.  `Σ (i=1..n) v_i * x_i → max`.

##### **3.2. Метод динамического программирования**
**Определение состояния:** Пусть `F(i, s)` — **максимальная стоимость**, которую можно набрать, используя только первые `i` предметов (1...i) и не превышая вместимость `s` (где `0 ≤ s ≤ W`).

**Базовые случаи:**
*   `F(0, s) = 0` для любого `s` (нет предметов — нулевая стоимость).
*   `F(i, 0) = 0` для любого `i` (нулевая вместимость).

**Рекуррентное соотношение (переход):**
Для каждого предмета `i` и вместимости `s` есть два варианта:
1.  **Не брать предмет `i`.** Тогда стоимость остаётся такой же, как для первых `i-1` предметов: `F(i-1, s)`.
2.  **Взять предмет `i`** (если `w_i ≤ s`). Тогда общая стоимость равна стоимости предмета `i` плюс лучшая стоимость для оставшейся вместимости, набранная из первых `i-1` предметов: `v_i + F(i-1, s - w_i)`.
Выбираем лучший вариант:
`F(i, s) = max{ F(i-1, s), (v_i + F(i-1, s - w_i)) если w_i ≤ s }`

**Порядок вычислений:** Заполняем таблицу размером `(n+1) × (W+1)` по строкам (увеличивая `i`).

**Восстановление ответа:** Начинаем с ячейки `(n, W)`. Если `F(i, s) == F(i-1, s)`, то предмет `i` не был взят, переходим к `(i-1, s)`. Иначе предмет `i` был взят, включаем его в ответ и переходим к `(i-1, s - w_i)`.

##### **3.3. Пример**
Пусть `W = 7`, предметы:
1.  (w=3, v=4)
2.  (w=4, v=5)
3.  (w=2, v=3)
4.  (w=1, v=1)

Таблица `F(i, s)`:

| i\s | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |
| :--- | :- | :- | :- | :- | :- | :- | :- | :- |
| **0** | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
| **1** | 0 | 0 | 0 | **4** | 4 | 4 | 4 | 4 |
| **2** | 0 | 0 | 0 | 4 | **max(4,5)=5** | 5 | 5 | **max(4,4+5)=9** |
| **3** | 0 | 0 | 3 | **max(4,3)=4** | max(5,3+4)=**7** | max(5,3+5)=**8** | max(5,3+7)=**10** | max(9,3+8)=**11** |
| **4** | 0 | 1 | **max(3,1)=3** | max(4,1+3)=**4** | max(7,1+4)=**7** | max(8,1+7)=**8** | max(10,1+8)=**10** | max(11,1+10)=**11** |

**Ответ:** Максимальная стоимость `F(4, 7) = 11`.
**Восстановление:** `F(4,7) != F(3,7)` → берём предмет 4 (w=1, v=1). Переход к `(3, 6)`. `F(3,6) != F(2,6)` → берём предмет 3 (w=2, v=3). Переход к `(2, 4)`. `F(2,4) != F(1,4)` → берём предмет 2 (w=4, v=5). Переход к `(1, 0)`. Конец.
**Состав:** Предметы 2, 3, 4. Суммарный вес: 4+2+1=7. Стоимость: 5+3+1=9? **Ошибка в восстановлении!** Стоимость должна быть 11. Давайте восстановим корректно.

*   `F(4,7)=11`. Проверяем предмет 4: `v_4 + F(3,6) = 1 + 10 = 11`. Совпадает. Значит, предмет 4 **взят**. `s = 7-1=6`, `i=3`.
*   `F(3,6)=10`. Проверяем предмет 3: `v_3 + F(2,4) = 3 + 5 = 8`. Это **не равно** 10. Значит, предмет 3 **не взят**. Остаёмся при `s=6`, переходим к `i=2`.
*   `F(2,6)=9`. Проверяем предмет 2: `v_2 + F(1,2) = 5 + 0 = 5`. Не равно 9. Предмет 2 **не взят**. `s=6`, `i=1`.
*   `F(1,6)=4`. Проверяем предмет 1: `v_1 + F(0,3) = 4 + 0 = 4`. Совпадает. Предмет 1 **взят**. `s=6-3=3`, `i=0`. Конец.

**Корректный состав:** Предметы 1 и 4. Вес: 3+1=4 (<7). Стоимость: 4+1=5. **Снова неверно!** Ошибка в таблице. Давайте пересчитаем ячейку `F(2,7)`.

`F(2,7) = max( F(1,7), v_2 + F(1, 7-4) ) = max(4, 5 + F(1,3)) = max(4, 5+4) = 9` — верно.

`F(3,6) = max( F(2,6), v_3 + F(2, 6-2) ) = max(9, 3 + F(2,4))`. `F(2,4)=5`. Итак, `max(9, 3+5) = max(9,8) = 9`. Моя ошибка! В таблице для `F(3,6)` должно быть **9**, а не 10. Исправляем таблицу.

**Итоговая версия:**
*   `F(3,6) = max(F(2,6)=9, 3+F(2,4)=3+5=8) = 9`.
*   `F(4,7) = max(F(3,7), 1+F(3,6))`. `F(3,7)=11`, `1+9=10`. Итак, `F(4,7) = 11`.

Теперь восстановление:
*   `F(4,7)=11`. Сравниваем: `F(3,7)=11`. Равно! Значит, предмет 4 **не взят**. `s=7`, `i=3`.
*   `F(3,7)=11`. Сравниваем: `F(2,7)=9`. Не равно! Значит, предмет 3 **взят**. `v_3 + F(2,5) = 3 + F(2,5)` должно быть равно 11. `F(2,5)=5`. 3+5=8 ≠11. **Нестыковка.** Очевидна ошибка в моих промежуточных расчётах.

Давайте рассчитаем **полностью корректно**.

**Предметы:** 1(3,4), 2(4,5), 3(2,3), 4(1,1). `W=7`.

**Таблица F(i,s):**
s:        0  1  2  3  4  5  6  7
i=0:    [0, 0, 0, 0, 0, 0, 0, 0]
i=1:    [0, 0, 0, 4, 4, 4, 4, 4]  (предмет w=3)
i=2:    [0, 0, 0, 4, max(4,0+5)=5, 5, 5, max(4,5+0?)=5? НЕТ! Для s=7: max(F(1,7)=4, 5+F(1,3)=5+4=9) = 9]
Правильно для i=2:
F(2,0)=0, F(2,1)=0, F(2,2)=0, F(2,3)=max(4,5+?)=4 (т.к. 5+F(1,-1) — нельзя), F(2,4)=max(4,5+F(1,0)=5)=5,
F(2,5)=max(4,5+F(1,1)=5)=5, F(2,6)=max(4,5+F(1,2)=5)=5, F(2,7)=max(4,5+F(1,3)=5+4=9)=9.

i=3 (w=2,v=3):
F(3,0)=0
F(3,1)=max(F(2,1)=0, 3+F(2,-1)) = 0
F(3,2)=max(F(2,2)=0, 3+F(2,0)=3) = 3
F(3,3)=max(F(2,3)=4, 3+F(2,1)=3) = 4
F(3,4)=max(F(2,4)=5, 3+F(2,2)=3) = 5
F(3,5)=max(F(2,5)=5, 3+F(2,3)=3+4=7) = 7
F(3,6)=max(F(2,6)=5, 3+F(2,4)=3+5=8) = 8
F(3,7)=max(F(2,7)=9, 3+F(2,5)=3+5=8) = 9

i=4 (w=1,v=1):
F(4,0)=0
F(4,1)=max(F(3,1)=0, 1+F(3,0)=1) = 1
F(4,2)=max(F(3,2)=3, 1+F(3,1)=1) = 3
F(4,3)=max(F(3,3)=4, 1+F(3,2)=1+3=4) = 4
F(4,4)=max(F(3,4)=5, 1+F(3,3)=1+4=5) = 5
F(4,5)=max(F(3,5)=7, 1+F(3,4)=1+5=6) = 7
F(4,6)=max(F(3,6)=8, 1+F(3,5)=1+7=8) = 8
F(4,7)=max(F(3,7)=9, 1+F(3,6)=1+8=9) = 9

**Итог:** `F(4,7) = 9`.
**Восстановление:** `F(4,7)=9` и `F(3,7)=9` равны → предмет 4 не взят.
`F(3,7)=9` и `F(2,7)=9` равны → предмет 3 не взят.
`F(2,7)=9` и `F(1,7)=4` не равны → предмет 2 **взят**. Переход к `F(1, 7-4=3)`.
`F(1,3)=4` и `F(0,3)=0` не равны → предмет 1 **взят**. Переход к `F(0,0)`. Конец.
**Состав:** Предметы 1 и 2. Вес: 3+4=7. Стоимость: 4+5=9. Всё сходится.

Этот пример демонстрирует важность аккуратного заполнения таблицы.

---

#### **4. Ключевые различия задач**

| Признак | **Неограниченный рюкзак** | **Рюкзак 0-1** |
| :--- | :--- | :--- |
| **Количество предметов** | Неограниченно | Один каждого типа |
| **Состояние ДП** | `F(s)` — зависит только от вместимости | `F(i, s)` — зависит от вместимости и рассмотренных предметов |
| **Рекуррентная формула** | `F(s) = max_{i} {F(s-w_i)+v_i}` | `F(i,s)=max{F(i-1,s), v_i+F(i-1,s-w_i)}` |
| **Порядок вычислений** | Одномерный массив, `s` от 1 до `W` | Двумерная таблица, `i` от 1 до `n`, `s` от 0 до `W` |
| **Сложность** | O(n·W) | O(n·W) |

Этот конспект представляет собой строгое математическое изложение методов динамического программирования для двух фундаментальных задач о рюкзаке.